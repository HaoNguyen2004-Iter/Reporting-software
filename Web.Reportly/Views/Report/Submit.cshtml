@{
    ViewData["Title"] = "Nộp báo cáo";
    // Lấy DepartmentName từ Session để auto-fill
    var departmentName = Context.Session.GetString("DepartmentName") ?? "Chưa đăng nhập";
    // Lấy Tuần hiện tại từ ViewData
    var currentWeek = ViewData["CurrentWeek"]?.ToString() ?? $"Tuần {DateTime.Now:W}";
}

@section Styles {
    <style>
        /* Email Preview */
        .email-preview {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .email-field {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .email-field:last-child {
            border-bottom: none;
        }
    </style>
}

<div class="row">
    <div class="col-lg-8">
        <!-- Submit Form Card -->
        <div class="card">
            <div class="card-body p-5">
                <h3 class="mb-4">Báo cáo tuần</h3>
                
                <form id="submitForm">
                    <div class="mb-4">
                        <label class="form-label">Bộ phận:</label>
                        <!-- 
                            SỬA:
                            1. Dùng @departmentName để điền giá trị từ Session
                            2. Thêm 'readonly' để người dùng không thể sửa
                        -->
                        <input type="text" class="form-control form-control-lg" id="department" value="@departmentName" maxlength="100" required readonly>
                    
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Tuần báo cáo</label>
                        <!-- 
                            SỬA:
                            1. Dùng @currentWeek để điền giá trị từ Server
                            2. Thêm 'readonly'
                        -->
                        <input type="text" class="form-control form-control-lg" id="week" value="@currentWeek" required readonly>
                        
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Người nhận</label>
                        <input type="email" class="form-control form-control-lg" id="toEmail" placeholder="abc@gmail.com" maxlength="256" required>
                        <small class="form-text text-muted">Tối đa 256 ký tự</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">CC</label>
                        <input type="text" class="form-control form-control-lg" id="ccEmail" placeholder="def@gmail.com, xyz@gmail.com, aaa@gmail.com" maxlength="1000">
                        <small class="form-text text-muted">Tối đa 1000 ký tự (nhiều email cách nhau bằng dấu phẩy)</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Nội dung báo cáo</label>
                        <div id="summernote" style="min-height: 300px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                          
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Đính kèm file PDF báo cáo <span class="text-danger">*</span></label>
                        <input type="file" class="form-control form-control-lg" id="pdfFile" accept=".pdf" required>
                        <small class="form-text text-muted">File PDF đã xuất từ trang "Viết báo cáo"</small>
                        <div id="pdfPreview" class="mt-2"></div>
                    </div>

                    <div class="text-end">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            Gửi báo cáo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- Summernote -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.js"></script>
    
    <script src="~/assets/js/submit.js"></script>
}